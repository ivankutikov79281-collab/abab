
    <!DOCTYPE html>
    <html lang="ru">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Воронка до и после заказа</title>
        <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
        <style>
            body {
                font-family: Arial, sans-serif;
                margin: 20px;
                background-color: #f5f5f5;
            }
            .container {
                max-width: 1200px;
                margin: 0 auto;
                background-color: white;
                padding: 20px;
                border-radius: 8px;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            .filters {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 15px;
                margin-bottom: 20px;
                padding: 20px;
                background-color: #f8f9fa;
                border-radius: 6px;
            }
            .filter-group {
                display: flex;
                flex-direction: column;
            }
            label {
                margin-bottom: 5px;
                font-weight: bold;
                color: #333;
            }
            select, input {
                padding: 8px;
                border: 1px solid #ddd;
                border-radius: 4px;
                font-size: 14px;
            }
            .checkbox-group {
                display: flex;
                flex-direction: column;
                gap: 8px;
                max-height: 150px;
                overflow-y: auto;
                padding: 10px;
                border: 1px solid #ddd;
                border-radius: 4px;
                background-color: white;
            }
            .checkbox-item {
                display: flex;
                align-items: center;
                gap: 8px;
            }
            .checkbox-item input {
                margin: 0;
            }
            .button-container {
                text-align: center;
                margin: 20px 0;
            }
            #request-btn {
                padding: 12px 24px;
                background-color: #007bff;
                color: white;
                border: none;
                border-radius: 6px;
                cursor: pointer;
                font-size: 16px;
                transition: background-color 0.3s;
            }
            #request-btn:hover {
                background-color: #0056b3;
            }
            #request-btn.loading {
                background-color: #6c757d;
                cursor: not-allowed;
            }
            .sankey-container {
                margin-top: 20px;
                border: 1px solid #ddd;
                border-radius: 6px;
                padding: 10px;
                background-color: white;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <h1>Аналитическая панель</h1>

            <!-- 1) Фильтры -->
            <div class="filters">
                <div class="filter-group">
                    <label for="date">Дата:</label>
                    <input type="date" id="date" value="2025-10-23">
                </div>

                <div class="filter-group">
                    <label for="granularity">Гранулярность:</label>
                    <select id="granularity">
                        <option value="month">Месяц</option>
                        <option value="week">Неделя</option>
                        <option value="week">День</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label for="tour-type">Тип экскурсии:</label>
                    <select id="tour-type">
                        <option value="individual">Все</option>
                        <option value="individual">Индивидуальная</option>
                        <option value="group">Групповая</option>
                        <option value="group">Авторский тур</option>
                        <option value="group">Прогулка</option>
                        <option value="group">Билет</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label for="country">Страна</label>
                    <select id="country">
                        <option value="individual">Все</option>
                        <option value="russia">Россия</option>
                        <option value="not-russia">Турция</option>
                        <option value="not-russia">Грузия</option>
                        <option value="not-russia">Италия</option>
                        <option value="not-russia">Испания</option>
                        <option value="not-russia">Узбекистан</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="country">Платформа:</label>
                    <select id="country">
                        <option value="russia">Web desktop</option>
                        <option value="not-russia">Web mobile</option>
                        <option value="not-russia">App android</option>
                        <option value="not-russia">App ios</option>
                    </select>
                </div>
            </div>

            <!-- Вторая строка фильтров -->
        <div class="filters">
            <div class="filter-group">
                <details class="dropdown">
                    <summary>Только клиенты заходившие на страницы</summary>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="channel-organic">
                            <label for="channel-organic">Заход на главную до листинга</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="channel-social">
                            <label for="channel-social">Заход на Article до листинга</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="channel-email">
                            <label for="channel-email">Заход на Э до листинга</label>
                        </div>
                    </div>
                </details>
            </div>
    
    <details class="dropdown">
        <summary>Только клиенты использовавшие</summary>
        <div class="checkbox-group">
            <div class="checkbox-item">
                <input type="checkbox" id="channel-organic">
                <label for="channel-organic">Открыт поиск на главной</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="channel-social">
                <label for="channel-social">Открыт фильтр на листинге</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="channel-email">
                <label for="channel-email">Страница букинга через вопрос</label>
            </div>
        </div>
    </details>
</div>


            <!-- 2) Кнопка запроса -->
            <div class="button-container">
                <button id="request-btn" onclick="requestDashboard()">Запросить дэшборд</button>
            </div>

<!-- 3) Sankey диаграмма -->
            <div class="sankey-container">
                <h3>{{ zagolovok }}</h3>
                {{ sankey_html1 }}<br>
                {{ sankey_html2 }}
            </div>
        </div>
        

        <script>
            let isRequesting = false;

            function requestDashboard() {
                if (isRequesting) return;

                const btn = document.getElementById('request-btn');
                const originalText = btn.textContent;

                // Блокируем кнопку и меняем текст
                isRequesting = true;
                btn.textContent = 'Загрузка...';
                btn.classList.add('loading');
                btn.disabled = true;

                // Получаем значения фильтров
                const filters = {
                    date: document.getElementById('date').value,
                    granularity: document.getElementById('granularity').value,
                    tourType: document.getElementById('tour-type').value,
                    country: document.getElementById('country').value
                };

                console.log('Запрошенные фильтры:', filters);

                // Имитация запроса к серверу
                setTimeout(() => {
                    // В реальном приложении здесь был бы AJAX запрос
                    // и обновление данных диаграммы

                    // Восстанавливаем кнопку
                    btn.textContent = 'Дэшборд обновлен!';
                    btn.style.backgroundColor = '#28a745';

                    setTimeout(() => {
                        btn.textContent = originalText;
                        btn.style.backgroundColor = '';
                        btn.classList.remove('loading');
                        btn.disabled = false;
                        isRequesting = false;
                    }, 2000);

                }, 1500);
            }

            // Инициализация даты по умолчанию
            document.addEventListener('DOMContentLoaded', function() {
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('date').value = today;
            });
        </script>
    </body>
    </html>
    
